{"ast":null,"code":"import { BehaviorSubject, EMPTY, concatMap } from 'rxjs';\nimport { HttpHeaders } from '@angular/common/http';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"./auth.service\";\nclass CartService {\n  constructor(http, authService) {\n    this.http = http;\n    this.authService = authService;\n    this.apiUrlForShoppingCart = 'http://localhost:8000/api/purchases/shoppingcart';\n    this.apiUrlForProducts = 'http://localhost:8000/api/products/get-product/';\n    this.shoppingCart = new BehaviorSubject({\n      shoppingCart_id: '',\n      shoppingCart_created_at: '',\n      shoppingCart_updated_at: '',\n      shoppingCart_items: [],\n      shoppingCart_user_id: ''\n    });\n    this.shoppingCart$ = this.shoppingCart.asObservable();\n    this.shoppingCartAmount = new BehaviorSubject(0);\n    this.shoppingCartAmount$ = this.shoppingCartAmount.asObservable();\n    this.currentAmount = 0;\n    this.getItemsFromShoppingCart();\n  }\n  getItemsFromShoppingCart() {\n    const refreshToken = this.authService.getRefreshToken();\n    if (refreshToken) {\n      const headers = new HttpHeaders({\n        'Authorization': `Bearer ${refreshToken}`\n      });\n      const itemsFromCart = this.http.get(`${this.apiUrlForShoppingCart}/get-items-from-cart`, {\n        headers\n      });\n      itemsFromCart.subscribe(data => {\n        this.shoppingCart.next(data);\n      });\n    }\n    return EMPTY;\n  }\n  addToCart(itemId) {\n    const refreshToken = this.authService.getRefreshToken();\n    if (refreshToken) {\n      const headers = new HttpHeaders({\n        'Authorization': `Bearer ${refreshToken}`\n      });\n      return this.http.post(`${this.apiUrlForShoppingCart}/add`, {\n        items: itemId\n      }, {\n        headers\n      }).subscribe(data => {\n        console.log(data);\n        this.getItemsFromShoppingCart();\n      });\n    }\n    return null;\n  }\n  getFullItemsOnCart() {\n    this.shoppingCart$.subscribe(data => {\n      console.log(data.shoppingCart_items);\n      let items = data.shoppingCart_items;\n      // const requests: any = items.map(itemId => {\n      //   const url = `${this.apiUrlForProducts}/${itemId}`;\n      //   return this.http.get(url);\n      return items.reduce((observable, itemId) => {\n        const url = `${this.apiUrlForProducts}/${itemId}`;\n        return observable.pipe(concatMap(() => this.http.get(url).pipe(catchError(error => {\n          console.error(`Error fetching item ${itemId}: ${error.message}`);\n          return of(null); // Continuar con la siguiente solicitud en caso de error\n        }))));\n      }, of([])); // Iniciar con un observable vacío\n    });\n  }\n}\n\nCartService.ɵfac = function CartService_Factory(t) {\n  return new (t || CartService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.AuthService));\n};\nCartService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: CartService,\n  factory: CartService.ɵfac,\n  providedIn: 'root'\n});\nexport { CartService };","map":{"version":3,"names":["BehaviorSubject","EMPTY","concatMap","HttpHeaders","CartService","constructor","http","authService","apiUrlForShoppingCart","apiUrlForProducts","shoppingCart","shoppingCart_id","shoppingCart_created_at","shoppingCart_updated_at","shoppingCart_items","shoppingCart_user_id","shoppingCart$","asObservable","shoppingCartAmount","shoppingCartAmount$","currentAmount","getItemsFromShoppingCart","refreshToken","getRefreshToken","headers","itemsFromCart","get","subscribe","data","next","addToCart","itemId","post","items","console","log","getFullItemsOnCart","reduce","observable","url","pipe","catchError","error","message","of","i0","ɵɵinject","i1","HttpClient","i2","AuthService","factory","ɵfac","providedIn"],"sources":["C:\\Users\\josed\\Escritorio\\WebDev\\1 ANGULAR\\frontEcommerceAngular\\src\\app\\services\\cart.service.ts"],"sourcesContent":["import { Injectable, OnInit } from '@angular/core';\nimport { BehaviorSubject, EMPTY, Observable, concatMap, forkJoin, from, tap, toArray } from 'rxjs';\nimport { AuthService } from './auth.service';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CartService {\n\n  private apiUrlForShoppingCart = 'http://localhost:8000/api/purchases/shoppingcart'\n\n  private apiUrlForProducts = 'http://localhost:8000/api/products/get-product/'\n\n  constructor(private http: HttpClient, private authService: AuthService) {\n    this.getItemsFromShoppingCart()\n  }\n\n  private shoppingCart: BehaviorSubject<ShoppingCart> = new BehaviorSubject<ShoppingCart>({\n    shoppingCart_id: '',\n    shoppingCart_created_at: '',\n    shoppingCart_updated_at: '',\n    shoppingCart_items: [],\n    shoppingCart_user_id: ''\n  });\n\n  shoppingCart$ = this.shoppingCart.asObservable()\n\n  private shoppingCartAmount: BehaviorSubject<any> = new BehaviorSubject<any>(0);\n\n  shoppingCartAmount$ = this.shoppingCartAmount.asObservable()\n\n  currentAmount: number = 0\n\n  getItemsFromShoppingCart(): Observable<ShoppingCart> {\n    const refreshToken = this.authService.getRefreshToken();\n    if (refreshToken) {\n      const headers = new HttpHeaders({\n        'Authorization': `Bearer ${refreshToken}`\n      });\n\n      const itemsFromCart = this.http.get<ShoppingCart>(`${this.apiUrlForShoppingCart}/get-items-from-cart`, { headers })\n\n      itemsFromCart.subscribe((data: ShoppingCart) => {\n        this.shoppingCart.next(data);\n      })\n    }\n    return EMPTY\n  }\n\n  addToCart(itemId: string) {\n    const refreshToken = this.authService.getRefreshToken();\n    if (refreshToken) {\n      const headers = new HttpHeaders({\n        'Authorization': `Bearer ${refreshToken}`\n      });\n      return this.http.post<any>(`${this.apiUrlForShoppingCart}/add`, { items: itemId }, { headers }).subscribe(data => {\n        console.log(data)\n        this.getItemsFromShoppingCart()\n      })\n    }\n    return null\n  }\n\n  getFullItemsOnCart(){\n    this.shoppingCart$.subscribe(data=>{\n      console.log(data.shoppingCart_items)\n      let items = data.shoppingCart_items\n\n      // const requests: any = items.map(itemId => {\n      //   const url = `${this.apiUrlForProducts}/${itemId}`;\n      //   return this.http.get(url);\n\n      return items.reduce((observable, itemId) => {\n        const url = `${this.apiUrlForProducts}/${itemId}`;\n        return observable.pipe(\n          concatMap(() => this.http.get(url).pipe(\n            catchError(error => {\n              console.error(`Error fetching item ${itemId}: ${error.message}`);\n              return of(null); // Continuar con la siguiente solicitud en caso de error\n            })\n          ))\n        );\n      }, of([])); // Iniciar con un observable vacío\n    }\n\n\n      });\n\n  }\n\n}\n\n\n\ninterface ShoppingCart {\n  shoppingCart_id: string;\n  shoppingCart_created_at: string;\n  shoppingCart_updated_at: string;\n  shoppingCart_items: string[];\n  shoppingCart_user_id: string;\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}