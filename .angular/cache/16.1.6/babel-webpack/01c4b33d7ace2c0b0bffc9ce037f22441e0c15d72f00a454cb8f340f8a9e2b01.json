{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/josed/Escritorio/WebDev/1 ANGULAR/frontEcommerceAngular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { __decorate } from \"tslib\";\nimport { HttpHeaders } from '@angular/common/http';\nimport { Component } from '@angular/core';\nlet CartComponent = class CartComponent {\n  constructor(r, ActivatedRoute, authService, cartService, productService, http) {\n    this.r = r;\n    this.authService = authService;\n    this.cartService = cartService;\n    this.productService = productService;\n    this.http = http;\n    this.productsInCart = [];\n    this.apiForPurchase = 'http://localhost:8000/api/payments/pay-with-stripe';\n  }\n  ngOnInit() {\n    this.getItemsInCart();\n    const user = localStorage.getItem(\"username\");\n    console.log(user);\n    const sessionId = localStorage.getItem('sessionId');\n    if (sessionId) {\n      // El sessionId está presente en el almacenamiento local\n      console.log('Session ID:', sessionId);\n      this.getPaymentStatus(sessionId);\n    } else {\n      // El sessionId no está presente en el almacenamiento local\n      console.log('Session ID no encontrado.');\n    }\n  }\n  getPaymentStatus(sessionId) {\n    const apiUrl = 'http://localhost:8000/api/payments/get-payment-status'; // Cambia la URL según tu configuración\n    const data = {\n      sessionId: sessionId\n    };\n    return this.http.post(apiUrl, data).subscribe(response => {\n      this.paymentStatus = response.payment_status;\n      console.log(response);\n    });\n  }\n  getItemsInCart() {\n    this.cartService.getItemsOnCart().subscribe(DATA => {\n      console.log(DATA);\n      this.productsInCart = DATA.map(element => {\n        return {\n          ...element,\n          imgUrl: this.getProductImageUrl(element.imageData.data, element.imageData.type)\n        };\n      });\n    });\n  }\n  getProductImageUrl(data, type) {\n    const base64Image = this.productService.arrayBufferToBase64(data);\n    return 'data:' + type + ';base64,' + base64Image;\n  }\n  deleteFromCart(product) {\n    console.log(product.id);\n    let id = product.id;\n    this.cartService.deleteItemInCart(id);\n  }\n  payWithStripe() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      let cart = JSON.parse(JSON.stringify(_this.productsInCart));\n      for (let i = 0; i < cart.length; i++) {\n        delete cart[i].imageData;\n        delete cart[i].imgUrl;\n      }\n      console.log(cart);\n      const refreshToken = _this.authService.getRefreshToken();\n      const username = localStorage.getItem(\"username\");\n      console.log(username);\n      const storedJsonString = localStorage.getItem('userInfo');\n      if (storedJsonString) {\n        const storedData = JSON.parse(storedJsonString);\n        console.log(storedData.email); // Output: value1\n        console.log(storedData.username); // Output: value2\n        console.log(storedData.firstName); // Output: value2\n        console.log(storedData.lastName); // Output: value2\n        const cartWithUserInfo = {\n          cart: cart,\n          firstName: storedData.firstName,\n          lastName: storedData.lastName,\n          email: storedData.email,\n          username: storedData.username\n        };\n        if (refreshToken) {\n          const headers = new HttpHeaders({\n            'Authorization': `Bearer ${refreshToken}`\n          });\n          return _this.http.post(_this.apiForPurchase, {\n            cartWithUserInfo\n          }, {\n            headers\n          }).subscribe(resp => {\n            const sessionUrl = resp.url;\n            console.log(resp.sessionResp.id);\n            localStorage.setItem('sessionId', resp.sessionResp.id);\n            window.location.href = sessionUrl;\n          });\n        }\n      } else {\n        console.log('No hay datos almacenados en localStorage.');\n      }\n      return null;\n    })();\n  }\n};\nCartComponent = __decorate([Component({\n  selector: 'app-cart',\n  templateUrl: './cart.component.html',\n  styleUrls: ['./cart.component.css']\n})], CartComponent);\nexport { CartComponent };","map":{"version":3,"names":["HttpHeaders","Component","CartComponent","constructor","r","ActivatedRoute","authService","cartService","productService","http","productsInCart","apiForPurchase","ngOnInit","getItemsInCart","user","localStorage","getItem","console","log","sessionId","getPaymentStatus","apiUrl","data","post","subscribe","response","paymentStatus","payment_status","getItemsOnCart","DATA","map","element","imgUrl","getProductImageUrl","imageData","type","base64Image","arrayBufferToBase64","deleteFromCart","product","id","deleteItemInCart","payWithStripe","_this","_asyncToGenerator","cart","JSON","parse","stringify","i","length","refreshToken","getRefreshToken","username","storedJsonString","storedData","email","firstName","lastName","cartWithUserInfo","headers","resp","sessionUrl","url","sessionResp","setItem","window","location","href","__decorate","selector","templateUrl","styleUrls"],"sources":["C:\\Users\\josed\\Escritorio\\WebDev\\1 ANGULAR\\frontEcommerceAngular\\src\\app\\components\\cart\\cart.component.ts"],"sourcesContent":["import { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { Component, OnInit } from '@angular/core';\nimport { AuthService } from 'src/app/services/auth.service';\nimport { CartService } from 'src/app/services/cart.service';\nimport { ProductService } from 'src/app/services/product.service';\nimport { NgxImageCompressService } from 'ngx-image-compress';\nimport { UsersService } from 'src/app/services/users.service';\nimport { ActivatedRoute } from '@angular/router';\n\n@Component({\n  selector: 'app-cart',\n  templateUrl: './cart.component.html',\n  styleUrls: ['./cart.component.css']\n})\nexport class CartComponent implements OnInit {\n\n  constructor(private r ActivatedRoute, private authService: AuthService, private cartService: CartService, private productService: ProductService, private http: HttpClient) { }\n\n  productsInCart: any = []\n\n  private apiForPurchase = 'http://localhost:8000/api/payments/pay-with-stripe'\n\n  sessionId!: string;\n  paymentStatus!: string;\n\n  ngOnInit(): void {\n    this.getItemsInCart()\n    const user = localStorage.getItem(\"username\")\n\n    console.log(user)\n    const sessionId = localStorage.getItem('sessionId');\n\n    if (sessionId) {\n      // El sessionId está presente en el almacenamiento local\n      console.log('Session ID:', sessionId);\n      this.getPaymentStatus(sessionId);\n\n    } else {\n      // El sessionId no está presente en el almacenamiento local\n      console.log('Session ID no encontrado.');\n    }\n  }\n\n  getPaymentStatus(sessionId: string) {\n    const apiUrl = 'http://localhost:8000/api/payments/get-payment-status'; // Cambia la URL según tu configuración\n    const data = { sessionId: sessionId };\n\n    return this.http.post(apiUrl, data).subscribe((response: any) => {\n      this.paymentStatus = response.payment_status;\n      console.log(response)\n    });\n  }\n\n\n  getItemsInCart() {\n    this.cartService.getItemsOnCart().subscribe((DATA: any) => {\n      console.log(DATA);\n      this.productsInCart = DATA.map((element: any) => {\n\n        return {\n          ...element,\n          imgUrl: this.getProductImageUrl(element.imageData.data, element.imageData.type)\n        };\n      });\n    });\n  }\n\n  getProductImageUrl(data: ArrayBuffer, type: string): string {\n    const base64Image = this.productService.arrayBufferToBase64(data);\n    return 'data:' + type + ';base64,' + base64Image;\n  }\n\n  deleteFromCart(product: any) {\n    console.log(product.id)\n    let id: string = product.id\n    this.cartService.deleteItemInCart(id)\n  }\n\n  async payWithStripe() {\n\n    let cart = JSON.parse(JSON.stringify(this.productsInCart));\n    for (let i = 0; i < cart.length; i++) {\n      delete cart[i].imageData\n      delete cart[i].imgUrl;\n    }\n\n    console.log(cart);\n\n    const refreshToken = this.authService.getRefreshToken();\n    const username = localStorage.getItem(\"username\")\n    console.log(username)\n\n    const storedJsonString = localStorage.getItem('userInfo');\n    if (storedJsonString) {\n      const storedData = JSON.parse(storedJsonString);\n      console.log(storedData.email); // Output: value1\n      console.log(storedData.username); // Output: value2\n      console.log(storedData.firstName); // Output: value2\n      console.log(storedData.lastName); // Output: value2\n\n      const cartWithUserInfo = {\n        cart: cart,\n        firstName: storedData.firstName,\n        lastName: storedData.lastName,\n        email: storedData.email,\n        username: storedData.username\n      };\n\n      if (refreshToken) {\n        const headers = new HttpHeaders({\n          'Authorization': `Bearer ${refreshToken}`\n        });\n\n        return this.http.post<any>(this.apiForPurchase, { cartWithUserInfo }, { headers }).subscribe(resp => {\n          const sessionUrl = resp.url;\n          console.log(resp.sessionResp.id)\n          localStorage.setItem('sessionId', resp.sessionResp.id);\n\n          window.location.href = sessionUrl;\n        })\n      }\n    } else {\n      console.log('No hay datos almacenados en localStorage.');\n    }\n\n    return null\n  }\n\n\n\n\n}\n\n\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}