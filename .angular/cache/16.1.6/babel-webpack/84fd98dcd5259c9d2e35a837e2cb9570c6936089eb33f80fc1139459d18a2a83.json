{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { HttpHeaders } from '@angular/common/http';\nimport { Component } from '@angular/core';\nlet CartComponent = class CartComponent {\n  constructor(imageCompressor, authService, cartService, productService, http) {\n    this.imageCompressor = imageCompressor;\n    this.authService = authService;\n    this.cartService = cartService;\n    this.productService = productService;\n    this.http = http;\n    this.productsInCart = [];\n    this.apiForPurchase = 'http://localhost:8000/api/payments/pay-with-stripe';\n  }\n  ngOnInit() {\n    this.getItemsInCart();\n  }\n  getItemsInCart() {\n    this.cartService.getItemsOnCart().subscribe(DATA => {\n      console.log(DATA);\n      this.productsInCart = DATA.map(element => {\n        return {\n          ...element,\n          imgUrl: this.getProductImageUrl(element.imageData.data, element.imageData.type)\n        };\n      });\n    });\n  }\n  getProductImageUrl(data, type) {\n    const base64Image = this.productService.arrayBufferToBase64(data);\n    return 'data:' + type + ';base64,' + base64Image;\n  }\n  deleteFromCart(product) {\n    console.log(product.id);\n    let id = product.id;\n    this.cartService.deleteItemInCart(id);\n  }\n  payWithStripe() {\n    let cart = JSON.parse(JSON.stringify(this.productsInCart));\n    cart.forEach(resp => {\n      delete resp.imageData;\n      delete resp.imgUrl;\n    });\n    console.log(cart);\n    console.log('cart');\n    const refreshToken = this.authService.getRefreshToken();\n    console.log(refreshToken);\n    if (refreshToken) {\n      const headers = new HttpHeaders({\n        'Authorization': `Bearer ${refreshToken}`\n      });\n      console.log(headers);\n      return this.http.post(this.apiForPurchase, {\n        cart\n      }, {\n        headers\n      }).subscribe(resp => {\n        console.log(resp);\n        console.log('resp');\n        const sessionUrl = resp.sessionUrl;\n        // Ahora puedes usar window.location para abrir la URL en el navegador\n        window.location.href = sessionUrl;\n      });\n    }\n    return null;\n  }\n};\nCartComponent = __decorate([Component({\n  selector: 'app-cart',\n  templateUrl: './cart.component.html',\n  styleUrls: ['./cart.component.css']\n})], CartComponent);\nexport { CartComponent };","map":{"version":3,"names":["HttpHeaders","Component","CartComponent","constructor","imageCompressor","authService","cartService","productService","http","productsInCart","apiForPurchase","ngOnInit","getItemsInCart","getItemsOnCart","subscribe","DATA","console","log","map","element","imgUrl","getProductImageUrl","imageData","data","type","base64Image","arrayBufferToBase64","deleteFromCart","product","id","deleteItemInCart","payWithStripe","cart","JSON","parse","stringify","forEach","resp","refreshToken","getRefreshToken","headers","post","sessionUrl","window","location","href","__decorate","selector","templateUrl","styleUrls"],"sources":["C:\\Users\\josed\\Escritorio\\WebDev\\1 ANGULAR\\frontEcommerceAngular\\src\\app\\components\\cart\\cart.component.ts"],"sourcesContent":["import { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { Component, OnInit } from '@angular/core';\nimport { AuthService } from 'src/app/services/auth.service';\nimport { CartService } from 'src/app/services/cart.service';\nimport { ProductService } from 'src/app/services/product.service';\nimport { ImageCompressorService } from 'image-compressor';\n\n@Component({\n  selector: 'app-cart',\n  templateUrl: './cart.component.html',\n  styleUrls: ['./cart.component.css']\n})\nexport class CartComponent implements OnInit {\n\n  constructor(private imageCompressor: ImageCompressorService, private authService: AuthService, private cartService: CartService, private productService: ProductService, private http: HttpClient) { }\n\n  productsInCart: any = []\n\n  private apiForPurchase = 'http://localhost:8000/api/payments/pay-with-stripe'\n\n  ngOnInit(): void {\n    this.getItemsInCart()\n  }\n\n  getItemsInCart() {\n    this.cartService.getItemsOnCart().subscribe((DATA: any) => {\n      console.log(DATA);\n      this.productsInCart = DATA.map((element: any) => {\n        return {\n          ...element,\n          imgUrl: this.getProductImageUrl(element.imageData.data, element.imageData.type)\n        };\n      });\n    });\n  }\n\n  getProductImageUrl(data: ArrayBuffer, type: string): string {\n    const base64Image = this.productService.arrayBufferToBase64(data);\n    return 'data:' + type + ';base64,' + base64Image;\n  }\n\n  deleteFromCart(product: any) {\n    console.log(product.id)\n    let id: string = product.id\n    this.cartService.deleteItemInCart(id)\n  }\n\n  payWithStripe() {\n    let cart = JSON.parse(JSON.stringify(this.productsInCart));\n\n    cart.forEach((resp: any) => {\n      delete resp.imageData;\n      delete resp.imgUrl;\n    });\n\n    console.log(cart);\n    console.log('cart');\n\n    const refreshToken = this.authService.getRefreshToken();\n    console.log(refreshToken)\n    if (refreshToken) {\n      const headers = new HttpHeaders({\n        'Authorization': `Bearer ${refreshToken}`\n      });\n      console.log(headers);\n\n      return this.http.post<any>(this.apiForPurchase, { cart }, { headers }).subscribe(resp => {\n        console.log(resp)\n        console.log('resp')\n\n        const sessionUrl = resp.sessionUrl;\n\n        // Ahora puedes usar window.location para abrir la URL en el navegador\n        window.location.href = sessionUrl;\n      })\n    }\n\n    return null\n\n  }\n\n}\n"],"mappings":";AAAA,SAAqBA,WAAW,QAAQ,sBAAsB;AAC9D,SAASC,SAAS,QAAgB,eAAe;AAWjD,IAAaC,aAAa,GAA1B,MAAaA,aAAa;EAExBC,YAAoBC,eAAuC,EAAUC,WAAwB,EAAUC,WAAwB,EAAUC,cAA8B,EAAUC,IAAgB;IAA7K,KAAAJ,eAAe,GAAfA,eAAe;IAAkC,KAAAC,WAAW,GAAXA,WAAW;IAAuB,KAAAC,WAAW,GAAXA,WAAW;IAAuB,KAAAC,cAAc,GAAdA,cAAc;IAA0B,KAAAC,IAAI,GAAJA,IAAI;IAErL,KAAAC,cAAc,GAAQ,EAAE;IAEhB,KAAAC,cAAc,GAAG,oDAAoD;EAJwH;EAMrMC,QAAQA,CAAA;IACN,IAAI,CAACC,cAAc,EAAE;EACvB;EAEAA,cAAcA,CAAA;IACZ,IAAI,CAACN,WAAW,CAACO,cAAc,EAAE,CAACC,SAAS,CAAEC,IAAS,IAAI;MACxDC,OAAO,CAACC,GAAG,CAACF,IAAI,CAAC;MACjB,IAAI,CAACN,cAAc,GAAGM,IAAI,CAACG,GAAG,CAAEC,OAAY,IAAI;QAC9C,OAAO;UACL,GAAGA,OAAO;UACVC,MAAM,EAAE,IAAI,CAACC,kBAAkB,CAACF,OAAO,CAACG,SAAS,CAACC,IAAI,EAAEJ,OAAO,CAACG,SAAS,CAACE,IAAI;SAC/E;MACH,CAAC,CAAC;IACJ,CAAC,CAAC;EACJ;EAEAH,kBAAkBA,CAACE,IAAiB,EAAEC,IAAY;IAChD,MAAMC,WAAW,GAAG,IAAI,CAAClB,cAAc,CAACmB,mBAAmB,CAACH,IAAI,CAAC;IACjE,OAAO,OAAO,GAAGC,IAAI,GAAG,UAAU,GAAGC,WAAW;EAClD;EAEAE,cAAcA,CAACC,OAAY;IACzBZ,OAAO,CAACC,GAAG,CAACW,OAAO,CAACC,EAAE,CAAC;IACvB,IAAIA,EAAE,GAAWD,OAAO,CAACC,EAAE;IAC3B,IAAI,CAACvB,WAAW,CAACwB,gBAAgB,CAACD,EAAE,CAAC;EACvC;EAEAE,aAAaA,CAAA;IACX,IAAIC,IAAI,GAAGC,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,SAAS,CAAC,IAAI,CAAC1B,cAAc,CAAC,CAAC;IAE1DuB,IAAI,CAACI,OAAO,CAAEC,IAAS,IAAI;MACzB,OAAOA,IAAI,CAACf,SAAS;MACrB,OAAOe,IAAI,CAACjB,MAAM;IACpB,CAAC,CAAC;IAEFJ,OAAO,CAACC,GAAG,CAACe,IAAI,CAAC;IACjBhB,OAAO,CAACC,GAAG,CAAC,MAAM,CAAC;IAEnB,MAAMqB,YAAY,GAAG,IAAI,CAACjC,WAAW,CAACkC,eAAe,EAAE;IACvDvB,OAAO,CAACC,GAAG,CAACqB,YAAY,CAAC;IACzB,IAAIA,YAAY,EAAE;MAChB,MAAME,OAAO,GAAG,IAAIxC,WAAW,CAAC;QAC9B,eAAe,EAAE,UAAUsC,YAAY;OACxC,CAAC;MACFtB,OAAO,CAACC,GAAG,CAACuB,OAAO,CAAC;MAEpB,OAAO,IAAI,CAAChC,IAAI,CAACiC,IAAI,CAAM,IAAI,CAAC/B,cAAc,EAAE;QAAEsB;MAAI,CAAE,EAAE;QAAEQ;MAAO,CAAE,CAAC,CAAC1B,SAAS,CAACuB,IAAI,IAAG;QACtFrB,OAAO,CAACC,GAAG,CAACoB,IAAI,CAAC;QACjBrB,OAAO,CAACC,GAAG,CAAC,MAAM,CAAC;QAEnB,MAAMyB,UAAU,GAAGL,IAAI,CAACK,UAAU;QAElC;QACAC,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAGH,UAAU;MACnC,CAAC,CAAC;;IAGJ,OAAO,IAAI;EAEb;CAED;AArEYxC,aAAa,GAAA4C,UAAA,EALzB7C,SAAS,CAAC;EACT8C,QAAQ,EAAE,UAAU;EACpBC,WAAW,EAAE,uBAAuB;EACpCC,SAAS,EAAE,CAAC,sBAAsB;CACnC,CAAC,C,EACW/C,aAAa,CAqEzB;SArEYA,aAAa"},"metadata":{},"sourceType":"module","externalDependencies":[]}