{"ast":null,"code":"import { HttpHeaders } from '@angular/common/http';\nimport { tap, throwError } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"./auth.service\";\nimport * as i3 from \"@angular/router\";\nclass ApiService {\n  constructor(http, authService, router) {\n    this.http = http;\n    this.authService = authService;\n    this.router = router;\n    this.apiUrl = 'http://localhost:8000/api';\n  }\n  // Método para realizar solicitudes GET a la API protegida 'REFRESH'\n  getMethod(route) {\n    const refreshToken = this.authService.getRefreshToken();\n    console.log(refreshToken);\n    if (refreshToken) {\n      const headers = new HttpHeaders({\n        'Authorization': `Bearer ${refreshToken}`\n      });\n      return this.http.get(`${this.apiUrl}/${route}`, {\n        headers\n      }).pipe(tap(data => {\n        console.log('acaaa' + data);\n        if (data.accessToken && data.refreshToken) {\n          this.authService.saveTokens(data.accessToken, data.refreshToken, data.username);\n        }\n      }));\n    } else {\n      return throwError(() => new Error('No se encontró el token de acceso'));\n    }\n  }\n}\nApiService.ɵfac = function ApiService_Factory(t) {\n  return new (t || ApiService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.AuthService), i0.ɵɵinject(i3.Router));\n};\nApiService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: ApiService,\n  factory: ApiService.ɵfac,\n  providedIn: 'root'\n});\nexport { ApiService };","map":{"version":3,"names":["HttpHeaders","tap","throwError","ApiService","constructor","http","authService","router","apiUrl","getMethod","route","refreshToken","getRefreshToken","console","log","headers","get","pipe","data","accessToken","saveTokens","username","Error","i0","ɵɵinject","i1","HttpClient","i2","AuthService","i3","Router","factory","ɵfac","providedIn"],"sources":["C:\\Users\\josed\\Escritorio\\WebDev\\1 ANGULAR\\frontEcommerceAngular\\src\\app\\services\\api.service.ts"],"sourcesContent":["import { HttpClient, HttpErrorResponse, HttpHeaders } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { AuthService } from './auth.service';\nimport { Router } from '@angular/router';\nimport { Observable, catchError, tap, throwError } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ApiService {\n  \n  private apiUrl = 'http://localhost:8000/api';\n\n  constructor(private http: HttpClient, private authService: AuthService, private router: Router) {}\n\n    // Método para realizar solicitudes GET a la API protegida 'REFRESH'\n    getMethod(route: any): Observable<any> {\n      const refreshToken = this.authService.getRefreshToken();\n      console.log(refreshToken)\n      if (refreshToken) {\n        const headers = new HttpHeaders({\n          'Authorization': `Bearer ${refreshToken}`\n        });\n        return this.http.get(`${this.apiUrl}/${route}`, { headers }).pipe(\n          tap((data: any) => {\n            console.log('acaaa' + data)\n            if (data.accessToken && data.refreshToken) {\n              this.authService.saveTokens(data.accessToken, data.refreshToken, data.username);\n            }\n          })\n        );\n      } else {\n        return throwError(() => new Error('No se encontró el token de acceso'));\n      }\n    }\n\n\n\n  }"],"mappings":"AAAA,SAAwCA,WAAW,QAAQ,sBAAsB;AAIjF,SAAiCC,GAAG,EAAEC,UAAU,QAAQ,MAAM;;;;;AAE9D,MAGaC,UAAU;EAIrBC,YAAoBC,IAAgB,EAAUC,WAAwB,EAAUC,MAAc;IAA1E,KAAAF,IAAI,GAAJA,IAAI;IAAsB,KAAAC,WAAW,GAAXA,WAAW;IAAuB,KAAAC,MAAM,GAANA,MAAM;IAF9E,KAAAC,MAAM,GAAG,2BAA2B;EAEqD;EAE/F;EACAC,SAASA,CAACC,KAAU;IAClB,MAAMC,YAAY,GAAG,IAAI,CAACL,WAAW,CAACM,eAAe,EAAE;IACvDC,OAAO,CAACC,GAAG,CAACH,YAAY,CAAC;IACzB,IAAIA,YAAY,EAAE;MAChB,MAAMI,OAAO,GAAG,IAAIf,WAAW,CAAC;QAC9B,eAAe,EAAE,UAAUW,YAAY;OACxC,CAAC;MACF,OAAO,IAAI,CAACN,IAAI,CAACW,GAAG,CAAC,GAAG,IAAI,CAACR,MAAM,IAAIE,KAAK,EAAE,EAAE;QAAEK;MAAO,CAAE,CAAC,CAACE,IAAI,CAC/DhB,GAAG,CAAEiB,IAAS,IAAI;QAChBL,OAAO,CAACC,GAAG,CAAC,OAAO,GAAGI,IAAI,CAAC;QAC3B,IAAIA,IAAI,CAACC,WAAW,IAAID,IAAI,CAACP,YAAY,EAAE;UACzC,IAAI,CAACL,WAAW,CAACc,UAAU,CAACF,IAAI,CAACC,WAAW,EAAED,IAAI,CAACP,YAAY,EAAEO,IAAI,CAACG,QAAQ,CAAC;;MAEnF,CAAC,CAAC,CACH;KACF,MAAM;MACL,OAAOnB,UAAU,CAAC,MAAM,IAAIoB,KAAK,CAAC,mCAAmC,CAAC,CAAC;;EAE3E;;AAzBSnB,UAAU,C;mBAAVA,UAAU,EAAAoB,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,UAAA,GAAAH,EAAA,CAAAC,QAAA,CAAAG,EAAA,CAAAC,WAAA,GAAAL,EAAA,CAAAC,QAAA,CAAAK,EAAA,CAAAC,MAAA;AAAA;AAAV3B,UAAU,C;SAAVA,UAAU;EAAA4B,OAAA,EAAV5B,UAAU,CAAA6B,IAAA;EAAAC,UAAA,EAFT;AAAM;SAEP9B,UAAU"},"metadata":{},"sourceType":"module","externalDependencies":[]}