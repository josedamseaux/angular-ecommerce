{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/josed/Escritorio/WebDev/1 ANGULAR/frontEcommerceAngular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { __decorate } from \"tslib\";\nimport { HttpHeaders } from '@angular/common/http';\nimport { Component } from '@angular/core';\nlet CartComponent = class CartComponent {\n  constructor(userService, authService, cartService, productService, http) {\n    this.userService = userService;\n    this.cartService = cartService;\n    this.productService = productService;\n    this.http = http;\n    this.productsInCart = [];\n    this.apiForPurchase = 'http://localhost:8000/api/payments/pay-with-stripe';\n    this.imgResultAfterCompression = '';\n    this.imgResultBeforeCompression = '';\n  }\n  ngOnInit() {\n    this.getItemsInCart();\n    const user = localStorage.getItem(\"username\");\n    console.log(user);\n  }\n  getItemsInCart() {\n    this.cartService.getItemsOnCart().subscribe(DATA => {\n      console.log(DATA);\n      this.productsInCart = DATA.map(element => {\n        return {\n          ...element,\n          imgUrl: this.getProductImageUrl(element.imageData.data, element.imageData.type)\n        };\n      });\n    });\n  }\n  getProductImageUrl(data, type) {\n    const base64Image = this.productService.arrayBufferToBase64(data);\n    return 'data:' + type + ';base64,' + base64Image;\n  }\n  deleteFromCart(product) {\n    console.log(product.id);\n    let id = product.id;\n    this.cartService.deleteItemInCart(id);\n  }\n  payWithStripe() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      let cart = JSON.parse(JSON.stringify(_this.productsInCart));\n      for (let i = 0; i < cart.length; i++) {\n        delete cart[i].imageData;\n        delete cart[i].imgUrl;\n      }\n      console.log(cart);\n      const refreshToken = _this.authService.getRefreshToken();\n      const username = localStorage.getItem(\"user\");\n      _this.authService.findUserAndPurchases(username);\n      if (refreshToken) {\n        const headers = new HttpHeaders({\n          'Authorization': `Bearer ${refreshToken}`\n        });\n        return _this.http.post(_this.apiForPurchase, {\n          cart\n        }, {\n          headers\n        }).subscribe(resp => {\n          const sessionUrl = resp.sessionUrl;\n          window.location.href = sessionUrl;\n        });\n      }\n      return null;\n    })();\n  }\n  compressFile(img) {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        const compressedImage = yield _this2.imageCompress.compressFile(img, 0, 20, 20); // 50% ratio, 50% quality\n        console.log('Size in bytes after compression is now:', _this2.imageCompress.byteCount(compressedImage));\n        return compressedImage;\n      } catch (error) {\n        console.error('Error al comprimir la imagen:', error);\n        throw error;\n      }\n    })();\n  }\n};\nCartComponent = __decorate([Component({\n  selector: 'app-cart',\n  templateUrl: './cart.component.html',\n  styleUrls: ['./cart.component.css']\n})], CartComponent);\nexport { CartComponent };","map":{"version":3,"names":["HttpHeaders","Component","CartComponent","constructor","userService","authService","cartService","productService","http","productsInCart","apiForPurchase","imgResultAfterCompression","imgResultBeforeCompression","ngOnInit","getItemsInCart","user","localStorage","getItem","console","log","getItemsOnCart","subscribe","DATA","map","element","imgUrl","getProductImageUrl","imageData","data","type","base64Image","arrayBufferToBase64","deleteFromCart","product","id","deleteItemInCart","payWithStripe","_this","_asyncToGenerator","cart","JSON","parse","stringify","i","length","refreshToken","getRefreshToken","username","findUserAndPurchases","headers","post","resp","sessionUrl","window","location","href","compressFile","img","_this2","compressedImage","imageCompress","byteCount","error","__decorate","selector","templateUrl","styleUrls"],"sources":["C:\\Users\\josed\\Escritorio\\WebDev\\1 ANGULAR\\frontEcommerceAngular\\src\\app\\components\\cart\\cart.component.ts"],"sourcesContent":["import { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { Component, OnInit } from '@angular/core';\nimport { AuthService } from 'src/app/services/auth.service';\nimport { CartService } from 'src/app/services/cart.service';\nimport { ProductService } from 'src/app/services/product.service';\nimport { NgxImageCompressService } from 'ngx-image-compress';\n\n@Component({\n  selector: 'app-cart',\n  templateUrl: './cart.component.html',\n  styleUrls: ['./cart.component.css']\n})\nexport class CartComponent implements OnInit {\n\n  constructor(private userService: Userprivate authService: AuthService, private cartService: CartService, private productService: ProductService, private http: HttpClient) { }\n\n  productsInCart: any = []\n\n  private apiForPurchase = 'http://localhost:8000/api/payments/pay-with-stripe'\n\n  ngOnInit(): void {\n    this.getItemsInCart()\n    const user = localStorage.getItem(\"username\")\n\n    console.log(user)\n  }\n\n  getItemsInCart() {\n    this.cartService.getItemsOnCart().subscribe((DATA: any) => {\n      console.log(DATA);\n      this.productsInCart = DATA.map((element: any) => {\n        \n        return {\n          ...element,\n          imgUrl: this.getProductImageUrl(element.imageData.data, element.imageData.type)\n        };\n      });\n    });\n  }\n\n  getProductImageUrl(data: ArrayBuffer, type: string): string {\n    const base64Image = this.productService.arrayBufferToBase64(data);\n    return 'data:' + type + ';base64,' + base64Image;\n  }\n\n  deleteFromCart(product: any) {\n    console.log(product.id)\n    let id: string = product.id\n    this.cartService.deleteItemInCart(id)\n  }\n\n  async payWithStripe() {\n\n    let cart = JSON.parse(JSON.stringify(this.productsInCart));\n    for (let i = 0; i < cart.length; i++) {\n        delete cart[i].imageData \n        delete cart[i].imgUrl;\n    }\n\n    console.log(cart);\n\n    const refreshToken = this.authService.getRefreshToken();\n    const username = localStorage.getItem(\"user\")\n    this.authService.findUserAndPurchases(username)\n    if (refreshToken) {\n      const headers = new HttpHeaders({\n        'Authorization': `Bearer ${refreshToken}`\n      });\n\n\n\n      return this.http.post<any>(this.apiForPurchase, { cart }, { headers }).subscribe(resp => {\n        const sessionUrl = resp.sessionUrl;\n        window.location.href = sessionUrl;\n      })\n    }\n    return null\n  }\n\n  imgResultAfterCompression: string = '';\n  imgResultBeforeCompression: string = '';\n\n  async compressFile(img: any): Promise<any> {\n    try {\n      const compressedImage = await this.imageCompress\n        .compressFile(img, 0, 20, 20 ); // 50% ratio, 50% quality\n      console.log('Size in bytes after compression is now:', this.imageCompress.byteCount(compressedImage));\n      return compressedImage;\n    } catch (error) {\n      console.error('Error al comprimir la imagen:', error);\n      throw error;\n    }\n  }\n\n\n}\n\n\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}