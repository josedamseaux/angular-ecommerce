{"ast":null,"code":"import { HttpHeaders } from '@angular/common/http';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"ngx-image-compress\";\nimport * as i2 from \"src/app/services/auth.service\";\nimport * as i3 from \"src/app/services/cart.service\";\nimport * as i4 from \"src/app/services/product.service\";\nimport * as i5 from \"@angular/common/http\";\nimport * as i6 from \"@angular/common\";\nfunction CartComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"div\", 4);\n    i0.ɵɵelement(2, \"img\", 5);\n    i0.ɵɵelementStart(3, \"button\", 6);\n    i0.ɵɵlistener(\"click\", function CartComponent_div_1_Template_button_click_3_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r4);\n      const product_r1 = restoredCtx.$implicit;\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.deleteFromCart(product_r1));\n    });\n    i0.ɵɵtext(4, \"ELIMINAR\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\", 7)(6, \"h5\", 8);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"p\", 9);\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const product_r1 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"src\", product_r1.imgUrl, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(product_r1.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(product_r1.description);\n  }\n}\nclass CartComponent {\n  constructor(imageCompress, authService, cartService, productService, http) {\n    this.imageCompress = imageCompress;\n    this.authService = authService;\n    this.cartService = cartService;\n    this.productService = productService;\n    this.http = http;\n    this.productsInCart = [];\n    this.apiForPurchase = 'http://localhost:8000/api/payments/pay-with-stripe';\n    this.imgResultBeforeCompression = '';\n    this.imgResultAfterCompression = '';\n  }\n  ngOnInit() {\n    this.getItemsInCart();\n  }\n  getItemsInCart() {\n    this.cartService.getItemsOnCart().subscribe(DATA => {\n      console.log(DATA);\n      this.productsInCart = DATA.map(element => {\n        return {\n          ...element,\n          imgUrl: this.getProductImageUrl(element.imageData.data, element.imageData.type)\n        };\n      });\n    });\n  }\n  getProductImageUrl(data, type) {\n    const base64Image = this.productService.arrayBufferToBase64(data);\n    return 'data:' + type + ';base64,' + base64Image;\n  }\n  deleteFromCart(product) {\n    console.log(product.id);\n    let id = product.id;\n    this.cartService.deleteItemInCart(id);\n  }\n  payWithStripe() {\n    let cart = JSON.parse(JSON.stringify(this.productsInCart));\n    cart.forEach(resp => {\n      delete resp.imageData;\n      delete resp.imgUrl;\n    });\n    console.log(cart);\n    console.log('cart');\n    const refreshToken = this.authService.getRefreshToken();\n    console.log(refreshToken);\n    if (refreshToken) {\n      const headers = new HttpHeaders({\n        'Authorization': `Bearer ${refreshToken}`\n      });\n      console.log(headers);\n      return this.http.post(this.apiForPurchase, {\n        cart\n      }, {\n        headers\n      }).subscribe(resp => {\n        console.log(resp);\n        console.log('resp');\n        const sessionUrl = resp.sessionUrl;\n        // Ahora puedes usar window.location para abrir la URL en el navegador\n        window.location.href = sessionUrl;\n      });\n    }\n    return null;\n  }\n  compressFile() {\n    this.imageCompress.compressFile(image, orientation, 50, 50) // 50% ratio, 50% quality\n    .then(compressedImage => {\n      this.imgResultAfterCompression = compressedImage;\n      console.log('Size in bytes after compression is now:', this.imageCompress.byteCount(compressedImage));\n    });\n  }\n}\nCartComponent.ɵfac = function CartComponent_Factory(t) {\n  return new (t || CartComponent)(i0.ɵɵdirectiveInject(i1.NgxImageCompressService), i0.ɵɵdirectiveInject(i2.AuthService), i0.ɵɵdirectiveInject(i3.CartService), i0.ɵɵdirectiveInject(i4.ProductService), i0.ɵɵdirectiveInject(i5.HttpClient));\n};\nCartComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: CartComponent,\n  selectors: [[\"app-cart\"]],\n  decls: 5,\n  vars: 1,\n  consts: [[1, \"container\"], [4, \"ngFor\", \"ngForOf\"], [1, \"payment-section\"], [1, \"btn\", \"btn-primary\", 3, \"click\"], [1, \"card\", 2, \"width\", \"18rem\"], [\"alt\", \"Product Image\", 2, \"width\", \"300px\", \"height\", \"350px\", 3, \"src\"], [\"href\", \"#\", 1, \"btn\", \"btn-danger\", 3, \"click\"], [1, \"card-body\"], [1, \"card-title\"], [1, \"card-text\"]],\n  template: function CartComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0);\n      i0.ɵɵtemplate(1, CartComponent_div_1_Template, 10, 3, \"div\", 1);\n      i0.ɵɵelementStart(2, \"div\", 2)(3, \"button\", 3);\n      i0.ɵɵlistener(\"click\", function CartComponent_Template_button_click_3_listener() {\n        return ctx.payWithStripe();\n      });\n      i0.ɵɵtext(4, \"PAGAR\");\n      i0.ɵɵelementEnd()()();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngForOf\", ctx.productsInCart);\n    }\n  },\n  dependencies: [i6.NgForOf],\n  styles: [\"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsInNvdXJjZVJvb3QiOiIifQ== */\"]\n});\nexport { CartComponent };","map":{"version":3,"names":["HttpHeaders","i0","ɵɵelementStart","ɵɵelement","ɵɵlistener","CartComponent_div_1_Template_button_click_3_listener","restoredCtx","ɵɵrestoreView","_r4","product_r1","$implicit","ctx_r3","ɵɵnextContext","ɵɵresetView","deleteFromCart","ɵɵtext","ɵɵelementEnd","ɵɵadvance","ɵɵproperty","imgUrl","ɵɵsanitizeUrl","ɵɵtextInterpolate","name","description","CartComponent","constructor","imageCompress","authService","cartService","productService","http","productsInCart","apiForPurchase","imgResultBeforeCompression","imgResultAfterCompression","ngOnInit","getItemsInCart","getItemsOnCart","subscribe","DATA","console","log","map","element","getProductImageUrl","imageData","data","type","base64Image","arrayBufferToBase64","product","id","deleteItemInCart","payWithStripe","cart","JSON","parse","stringify","forEach","resp","refreshToken","getRefreshToken","headers","post","sessionUrl","window","location","href","compressFile","image","orientation","then","compressedImage","byteCount","ɵɵdirectiveInject","i1","NgxImageCompressService","i2","AuthService","i3","CartService","i4","ProductService","i5","HttpClient","selectors","decls","vars","consts","template","CartComponent_Template","rf","ctx","ɵɵtemplate","CartComponent_div_1_Template","CartComponent_Template_button_click_3_listener"],"sources":["C:\\Users\\josed\\Escritorio\\WebDev\\1 ANGULAR\\frontEcommerceAngular\\src\\app\\components\\cart\\cart.component.ts","C:\\Users\\josed\\Escritorio\\WebDev\\1 ANGULAR\\frontEcommerceAngular\\src\\app\\components\\cart\\cart.component.html"],"sourcesContent":["import { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { Component, OnInit } from '@angular/core';\nimport { AuthService } from 'src/app/services/auth.service';\nimport { CartService } from 'src/app/services/cart.service';\nimport { ProductService } from 'src/app/services/product.service';\nimport {NgxImageCompressService} from 'ngx-image-compress';\n\n@Component({\n  selector: 'app-cart',\n  templateUrl: './cart.component.html',\n  styleUrls: ['./cart.component.css']\n})\nexport class CartComponent implements OnInit {\n\n  constructor(private imageCompress: NgxImageCompressService, private authService: AuthService, private cartService: CartService, private productService: ProductService, private http: HttpClient) { }\n\n  productsInCart: any = []\n\n  private apiForPurchase = 'http://localhost:8000/api/payments/pay-with-stripe'\n\n  ngOnInit(): void {\n    this.getItemsInCart()\n  }\n\n  getItemsInCart() {\n    this.cartService.getItemsOnCart().subscribe((DATA: any) => {\n      console.log(DATA);\n      this.productsInCart = DATA.map((element: any) => {\n        return {\n          ...element,\n          imgUrl: this.getProductImageUrl(element.imageData.data, element.imageData.type)\n        };\n      });\n    });\n  }\n\n  getProductImageUrl(data: ArrayBuffer, type: string): string {\n    const base64Image = this.productService.arrayBufferToBase64(data);\n    return 'data:' + type + ';base64,' + base64Image;\n  }\n\n  deleteFromCart(product: any) {\n    console.log(product.id)\n    let id: string = product.id\n    this.cartService.deleteItemInCart(id)\n  }\n\n  payWithStripe() {\n    let cart = JSON.parse(JSON.stringify(this.productsInCart));\n\n    cart.forEach((resp: any) => {\n      delete resp.imageData;\n      delete resp.imgUrl;\n    });\n\n    console.log(cart);\n    console.log('cart');\n\n    const refreshToken = this.authService.getRefreshToken();\n    console.log(refreshToken)\n    if (refreshToken) {\n      const headers = new HttpHeaders({\n        'Authorization': `Bearer ${refreshToken}`\n      });\n      console.log(headers);\n\n      return this.http.post<any>(this.apiForPurchase, { cart }, { headers }).subscribe(resp => {\n        console.log(resp)\n        console.log('resp')\n\n        const sessionUrl = resp.sessionUrl;\n\n        // Ahora puedes usar window.location para abrir la URL en el navegador\n        window.location.href = sessionUrl;\n      })\n    }\n\n    return null\n\n  }\n\n\n\n\n  imgResultBeforeCompression: string = '';\n  imgResultAfterCompression: string = '';\n\n  compressFile() {\n\n          this.imageCompress.compressFile(image, orientation, 50, 50) // 50% ratio, 50% quality\n              .then(compressedImage => {\n                  this.imgResultAfterCompression = compressedImage;\n                  console.log('Size in bytes after compression is now:', this.imageCompress.byteCount(compressedImage));\n              });\n      };\n  }\n  \n\n}\n","<div class=\"container\">\n  <div *ngFor=\"let product of productsInCart; let i = index\">\n    <div class=\"card\" style=\"width: 18rem;\">\n      <img [src]=\"product.imgUrl\" style=\"width: 300px; height: 350px;\" alt=\"Product Image\">\n      <button href=\"#\" class=\"btn btn-danger\" (click)=\"deleteFromCart(product)\">ELIMINAR</button>\n\n      <div class=\"card-body\">\n        <h5 class=\"card-title\">{{ product.name }}</h5>\n        <p class=\"card-text\">{{ product.description }}</p>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"payment-section\">\n    <button class=\"btn btn-primary\" (click)=\"payWithStripe()\">PAGAR</button>\n  </div>\n</div>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}